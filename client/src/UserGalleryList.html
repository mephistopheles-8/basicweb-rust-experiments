<script>
    import Alert from "svelte-material-icons/Alert.svelte";
    import Delete from "svelte-material-icons/Delete.svelte";
    import ReorderHorizontal from "svelte-material-icons/ReorderHorizontal.svelte";
    import PencilOutline from "svelte-material-icons/PencilOutline.svelte";
    import { Circle } from 'svelte-loading-spinners';
    import { dndzone } from 'svelte-dnd-action';
    import { flip } from 'svelte/animate';

    const api = "http://localhost:8080/api/v1";
    const flipDurationMs = 300;
   

    let iconSize = 24;
    let galleries = [];

    let galleriesReq 
        = fetch( `${api}/galleries` )
           .then( res => res.json() )
           .then( g0s => {
               galleries = g0s.map(g => {
                   let g1 = g[1];
                   g1.ord = g[0].ord;
                   return g1; 
               });
                return galleries;
            });

    function handleSortConsider(e) {
        galleries = e.detail.items;
        console.log(galleries[0]);
        console.log("CONSIDER", e);
    }
    function handleSortFinalize(e) {
        galleries = e.detail.items;
        console.log(galleries[0]);
        console.log("FINALIZE", e);
    }

    function sortList() {
        galleries.forEach( (item,i) => {
            item[0].ord = i;
        });
        console.log(galleries);
        galleries = galleries;
    };

</script>
<style>
    button {
        -moz-appearance:none;
        -webkit-appearance:none;
        appearance:none;
        cursor:pointer;
        border-style:none;
        background:transparent;
    }
    .gallery-list-item {
        background: var(--bg-color-3);
        display: flex;
        font-size: 1rem;
        border: dotted 1px var(--accent-color-0);
        border-left: solid 0.25rem var(--accent-color-1);
        transition: all 0.25s;
        max-width: 350px;
    }
    .gallery-list-item:hover {
        background: var(--fg-color-1);
        border-left-color: var(--accent-color-2);
    }
    .gallery-list-item > * {
        font-size: 1rem;
    }
    .gallery-list-info > * {
        padding: 0 0.5rem;
    }
    .gallery-list-item a {
        flex-grow: 1;
        color: var(--fg-color-3);
    }
</style>
{#await galleriesReq}
<Circle color="var(--accent-color-1)" size={iconSize} />
{:then _}
<section use:dndzone="{{items:galleries,flipDurationMs}}" on:consider={handleSortConsider} on:finalize={handleSortFinalize}>
    {#each galleries as item(item.id)}
    <div class="gallery-list-item" animate:flip="{{duration: flipDurationMs}}">
        <button>
            <ReorderHorizontal color="var(--accent-color-1)" size={iconSize} />
        </button>
        <a href="/user/galleries/{item.uuid}">
            <div class="gallery-list-info">
                <h6>{item.name}</h6>
                <p>{item.description}</p>
            </div>
        </a>
        <button class="edit-button" kind="button" on:click={e => console.log(e)}><PencilOutline size={iconSize} /></button>
        <button class="delete-button" kind="button" on:click={e => console.log(e)}><Delete size={iconSize} /></button>
    </div>
    {/each}
</section>
{:catch err}
<div class="error">
    <Alert color="#F80" size={iconSize} />
    <p>Error: {err.message}</p>
</div>
{/await}
